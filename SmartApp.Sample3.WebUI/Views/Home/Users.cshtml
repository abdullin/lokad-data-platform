@using ServiceStack.Text
@using SmartApp.Sample3.WebUI
@model SmartApp.Sample3.Contracts.UserCommentsDistributionView

<h2 class="page-header">Users projection</h2>
<dl class="dl-horizontal">
    <dt>Events proccessed:</dt>
    <dd>@(Model != null ? Model.EventsProcessed : 0)</dd>

    <dt>Bytes proccessed:</dt>
    <dd>@FormatUtil.SizeInBytes(Model != null ? Model.NextOffsetInBytes : 0)</dd>

    <dt>Date</dt>
    <dd>@DateTime.Now</dd>
</dl>

<table class="table table-striped table-condensed table-bordered">
    <tr>
        <th>User</th>
        <th>Comments per day of week</th>
    </tr>

    @if (Model.Distribution.Any())
    {
        var maxCommentsLimit = Model.Distribution.Max(x => x.Value.Sum()) * 0.1d;

        foreach (var pair in Model.Distribution.Where(x => maxCommentsLimit < x.Value.Sum()).OrderByDescending(x => x.Value.Sum()).Take(15))
        {
            <tr>
                <td>@Model.UserNames[pair.Key]</td>
                <td><span class="bar">@JsonSerializer.SerializeToString(pair.Value).Trim('[', ']') </span></td>
            </tr>
        }
    }
</table>
<br style="clear: both" />

<script>
    $(function() {
        $('.bar').sparkline("html", {type: 'bar', barWidth: '20px'});
    });
</script>